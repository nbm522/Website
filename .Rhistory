train<-data[folds!=i,]
test<-data[folds==i,]
truth<-test$primary.enforcement
fit4<-glm(y~(.)^2,data=train,family="binomial")
probs<-predict(fit4,newdata = test,type="response")
diags<-rbind(diags,class_diag(probs,truth))
}
diags%>%summarize_all(mean, na.rm=T)
blogdown::serve_site()
traffic2<-traffic%>%mutate(y=ifelse(primary.enforcement=="yes",1,0))
fit3<- glm(y~party+helmet_law, data=traffic2, family="binomial")
coeftest(fit3)
exp(coef(fit3))
prob<-predict(fit3,type="response")
class_diag(prob,traffic2$primary.enforcement)
pred<-ifelse(prob>.5,1,0)
table(prediction=pred, truth=traffic2$primary.enforcement)%>%addmargins
traffic2$logit<-predict(fit3,type="link")
traffic2%>%ggplot()+geom_density(aes(logit,fill=primary.enforcement), alpha=.4)+
theme(legend.position=c(.85,.85))+geom_vline(xintercept=0)+xlab("predictor (logit)")
ROCplot<-ggplot(traffic2)+geom_roc(aes(d=y,m=prob), n.cuts=0)+
geom_segment(aes(x=0,xend=1,y=0,yend=1),lty=2)
ROCplot
calc_auc(ROCplot)
traffic3<- traffic2[ -c(1, 13) ]
set.seed(1234)
k=10
data<-traffic3[sample(nrow(traffic3)),]
folds<-cut(seq(1:nrow(traffic3)),breaks=k,labels=F)
diags<-NULL
for(i in 1:k){
train<-data[folds!=i,]
test<-data[folds==i,]
truth<-test$primary.enforcement
fit4<-glm(y~(.)^2,data=train,family="binomial")
probs<-predict(fit4,newdata = test,type="response")
diags<-rbind(diags,class_diag(probs,truth))
}
library(plotROC)
library(dplyr)
library(lmtest)
traffic2<-traffic%>%mutate(y=ifelse(primary.enforcement=="yes",1,0))
fit3<- glm(y~party+helmet_law, data=traffic2, family="binomial")
coeftest(fit3)
exp(coef(fit3))
prob<-predict(fit3,type="response")
class_diag(prob,traffic2$primary.enforcement)
pred<-ifelse(prob>.5,1,0)
table(prediction=pred, truth=traffic2$primary.enforcement)%>%addmargins
traffic2$logit<-predict(fit3,type="link")
traffic2%>%ggplot()+geom_density(aes(logit,fill=primary.enforcement), alpha=.4)+
theme(legend.position=c(.85,.85))+geom_vline(xintercept=0)+xlab("predictor (logit)")
ROCplot<-ggplot(traffic2)+geom_roc(aes(d=y,m=prob), n.cuts=0)+
geom_segment(aes(x=0,xend=1,y=0,yend=1),lty=2)
ROCplot
calc_auc(ROCplot)
traffic3<- traffic2[ -c(1, 13) ]
set.seed(1234)
k=10
data<-traffic3[sample(nrow(traffic3)),]
folds<-cut(seq(1:nrow(traffic3)),breaks=k,labels=F)
diags<-NULL
for(i in 1:k){
train<-data[folds!=i,]
test<-data[folds==i,]
truth<-test$primary.enforcement
fit4<-glm(y~(.)^2,data=train,family="binomial")
probs<-predict(fit4,newdata = test,type="response")
diags<-rbind(diags,class_diag(probs,truth))
}
diags%>%summarize_all(mean, na.rm=T)
set.seed(1234)
k=10
data<-traffic3[sample(nrow(traffic3)),]
folds<-cut(seq(1:nrow(traffic3)),breaks=k,labels=F)
diags<-NULL
for(i in 1:k){
train<-data[folds!=i,]
test<-data[folds==i,]
truth<-test$primary.enforcement
fit4<-glm(y~(.)^2,data=train,family="binomial")
probs<-predict(fit4,newdata = test,type="response")
diags<-rbind(diags,class_diag(probs,truth))
}
fit4<-glm(y~(.)^2,data=train,family="binomial")
library(plotROC)
library(dplyr)
library(lmtest)
traffic2<-traffic%>%mutate(y=ifelse(primary.enforcement=="yes",1,0))
fit3<- glm(y~party+helmet_law, data=traffic2, family="binomial")
coeftest(fit3)
exp(coef(fit3))
prob<-predict(fit3,type="response")
class_diag(prob,traffic2$primary.enforcement)
pred<-ifelse(prob>.5,1,0)
table(prediction=pred, truth=traffic2$primary.enforcement)%>%addmargins
traffic2$logit<-predict(fit3,type="link")
traffic2%>%ggplot()+geom_density(aes(logit,fill=primary.enforcement), alpha=.4)+
theme(legend.position=c(.85,.85))+geom_vline(xintercept=0)+xlab("predictor (logit)")
ROCplot<-ggplot(traffic2)+geom_roc(aes(d=y,m=prob), n.cuts=0)+
geom_segment(aes(x=0,xend=1,y=0,yend=1),lty=2)
ROCplot
calc_auc(ROCplot)
traffic3<- traffic2[ -c(1, 13) ]
set.seed(1234)
k=10
data<-traffic3[sample(nrow(traffic3)),]
folds<-cut(seq(1:nrow(traffic3)),breaks=k,labels=F)
diags<-NULL
for(i in 1:k){
train<-data[folds!=i,]
test<-data[folds==i,]
truth<-test$primary.enforcement
fit4<-glm(y~(.)^2,data=train,family="binomial")
probs<-predict(fit4,newdata = test,type="response")
diags<-rbind(diags,class_diag(probs,truth))
}
diags%>%summarize_all(mean, na.rm=T)
fit4<-glm(y~(.)^2,data=train,family="binomial")
fit3<- glm(y~party+helmet_law, data=traffic2, family="binomial")
View(fit4)
prob<-predict(fit3,type="response")
probs<-predict(fit4,newdata = test,type="response")
knitr::opts_chunk$set(echo = TRUE)
class_diag<-function(probs,truth){
tab<-table(factor(probs>.5,levels=c("FALSE","TRUE")),truth)
acc=sum(diag(tab))/sum(tab)
sens=tab[2,2]/colSums(tab)[2]
spec=tab[1,1]/colSums(tab)[1]
ppv=tab[2,2]/rowSums(tab)[2]
if(is.numeric(truth)==FALSE & is.logical(truth)==FALSE) truth<-as.numeric(truth)-1
#CALCULATE EXACT AUC
ord<-order(probs, decreasing=TRUE)
probs <- probs[ord]; truth <- truth[ord]
TPR=cumsum(truth)/max(1,sum(truth))
FPR=cumsum(!truth)/max(1,sum(!truth))
dup<-c(probs[-1]>=probs[-length(probs)], FALSE)
TPR<-c(0,TPR[!dup],1); FPR<-c(0,FPR[!dup],1)
n <- length(TPR)
auc<- sum( ((TPR[-1]+TPR[-n])/2) * (FPR[-1]-FPR[-n]) )
data.frame(acc,sens,spec,ppv,auc)
}
library(plotROC)
traffic2<-traffic%>%mutate(y=ifelse(primary.enforcement=="yes",1,0))
fit3<- glm(y~party+helmet_law, traffic2, family="binomial")
coeftest(fit3)
exp(coef(fit3))
prob<-predict(fit3,type="response")
class_diag(prob,traffic2$y)
pred<-ifelse(prob>.5,1,0)
table(prediction=pred, truth=traffic2$y)%>%addmargins
traffic2$logit<-predict(fit3,type="link")
traffic2%>%ggplot()+geom_density(aes(logit,fill=primary.enforcement), alpha=.4)+
theme(legend.position=c(.85,.85))+geom_vline(xintercept=0)+xlab("predictor (logit)")
ROCplot<-ggplot(traffic2)+geom_roc(aes(d=y,m=prob), n.cuts=0)+
geom_segment(aes(x=0,xend=1,y=0,yend=1),lty=2)
ROCplot
calc_auc(ROCplot)
traffic3<- traffic2[ -c(1, 12, 14) ]
set.seed(1234)
k=10
data<-traffic3[sample(nrow(traffic3)),]
folds<-cut(seq(1:nrow(traffic3)),breaks=k,labels=F)
diags<-NULL
for(i in 1:k){
train<-data[folds!=i,]
test<-data[folds==i,]
truth<-test$primary.enforcement
fit4<-glm(primary.enforcement~(.)^2,data=train,family="binomial")
probs<-predict(fit4,newdata = test,type="response")
diags<-rbind(diags,class_diag(probs,truth))
}
blogdown::serve_site()
library(plotROC)
library(dplyr)
library(lmtest)
traffic2<-traffic%>%mutate(y=ifelse(primary.enforcement=="yes",1,0))
fit3<- glm(y~party+helmet_law, data=traffic2, family="binomial")
coeftest(fit3)
exp(coef(fit3))
prob<-predict(fit3,type="response")
class_diag(prob,traffic2$primary.enforcement)
pred<-ifelse(prob>.5,1,0)
table(prediction=pred, truth=traffic2$primary.enforcement)%>%addmargins
traffic2$logit<-predict(fit3,type="link")
traffic2%>%ggplot()+geom_density(aes(logit,fill=primary.enforcement), alpha=.4)+
theme(legend.position=c(.85,.85))+geom_vline(xintercept=0)+xlab("predictor (logit)")
ROCplot<-ggplot(traffic2)+geom_roc(aes(d=y,m=prob), n.cuts=0)+
geom_segment(aes(x=0,xend=1,y=0,yend=1),lty=2)
ROCplot
calc_auc(ROCplot)
traffic3<- traffic2[ -c(1, 13) ]
set.seed(1234)
k=10
data<-traffic3[sample(nrow(traffic3)),]
folds<-cut(seq(1:nrow(traffic3)),breaks=k,labels=F)
diags<-NULL
for(i in 1:k){
train<-data[folds!=i,]
test<-data[folds==i,]
truth<-test$primary.enforcement
fit4<-glm(y~(.)^2,data=train,family="binomial")
probs<-predict(fit4,newdata = test,type="response")
diags<-rbind(diags,class_diag(probs,truth))
}
knitr::opts_chunk$set(echo = TRUE)
class_diag<-function(probs,truth){
if(is.numeric(truth)==FALSE & is.logical(truth)==FALSE) truth<-as.numeric(truth)-1
tab<-table(factor(probs>.5,levels=c("FALSE","TRUE")),truth)
prediction<-ifelse(probs>.5,1,0)
acc=mean(truth==prediction)
sens=mean(prediction[truth==1]==1)
spec=mean(prediction[truth==0]==0)
ppv=mean(truth[prediction==1]==1)
#CALCULATE EXACT AUC
ord<-order(probs, decreasing=TRUE)
probs <- probs[ord]; truth <- truth[ord]
TPR=cumsum(truth)/max(1,sum(truth))
FPR=cumsum(!truth)/max(1,sum(!truth))
dup<-c(probs[-1]>=probs[-length(probs)], FALSE)
TPR<-c(0,TPR[!dup],1); FPR<-c(0,FPR[!dup],1)
n <- length(TPR)
auc<- sum( ((TPR[-1]+TPR[-n])/2) * (FPR[-1]-FPR[-n]) )
data.frame(acc,sens,spec,ppv,auc)
}
library(plotROC)
library(dplyr)
library(lmtest)
traffic2<-traffic%>%mutate(y=ifelse(primary.enforcement=="yes",1,0))
fit3<- glm(y~party+helmet_law, traffic2, family="binomial")
coeftest(fit3)
exp(coef(fit3))
prob<-predict(fit3,type="response")
class_diag(prob,traffic2$y)
pred<-ifelse(prob>.5,1,0)
table(prediction=pred, truth=traffic2$y)%>%addmargins
traffic2$logit<-predict(fit3,type="link")
traffic2%>%ggplot()+geom_density(aes(logit,fill=primary.enforcement), alpha=.4)+
theme(legend.position=c(.85,.85))+geom_vline(xintercept=0)+xlab("predictor (logit)")
ROCplot<-ggplot(traffic2)+geom_roc(aes(d=y,m=prob), n.cuts=0)+
geom_segment(aes(x=0,xend=1,y=0,yend=1),lty=2)
ROCplot
calc_auc(ROCplot)
traffic3<- traffic2[ -c(1, 13) ]
set.seed(1234)
k=10
data<-traffic3[sample(nrow(traffic3)),]
folds<-cut(seq(1:nrow(traffic3)),breaks=k,labels=F)
diags<-NULL
for(i in 1:k){
train<-data[folds!=i,]
test<-data[folds==i,]
truth<-test$y
fit4<-glm(y~(.)^2,data=train,family="binomial")
probs<-predict(fit4,newdata = test,type="response")
diags<-rbind(diags,class_diag(probs,truth))
}
diags%>%summarize_all(mean, na.rm=T)
View(test)
View(traffic)
View(traffic2)
View(traffic3)
View(train)
library(plotROC)
library(dplyr)
library(lmtest)
traffic2<-traffic%>%mutate(y=ifelse(primary.enforcement=="yes",1,0))
fit3<- glm(y~party+helmet_law, traffic2, family="binomial")
coeftest(fit3)
exp(coef(fit3))
prob<-predict(fit3,type="response")
class_diag(prob,traffic2$y)
pred<-ifelse(prob>.5,1,0)
table(prediction=pred, truth=traffic2$y)%>%addmargins
traffic2$logit<-predict(fit3,type="link")
traffic2%>%ggplot()+geom_density(aes(logit,fill=primary.enforcement), alpha=.4)+
theme(legend.position=c(.85,.85))+geom_vline(xintercept=0)+xlab("predictor (logit)")
ROCplot<-ggplot(traffic2)+geom_roc(aes(d=y,m=prob), n.cuts=0)+
geom_segment(aes(x=0,xend=1,y=0,yend=1),lty=2)
ROCplot
calc_auc(ROCplot)
traffic3<- traffic2[ -c(1, 13) ]
set.seed(1234)
k=10
data<-traffic3[sample(nrow(traffic3)),]
folds<-cut(seq(1:nrow(traffic3)),breaks=k,labels=F)
diags<-NULL
for(i in 1:k){
train<-data[folds!=i,]
test<-data[folds==i,]
truth<-test$y
fit4<-glm(y~(.)^2,data=train,family="binomial")
probs<-predict(fit4,newdata = test,type="response")
diags<-rbind(diags,class_diag(probs,truth))
}
diags%>%summarize_all(mean, na.rm=T)
knitr::opts_chunk$set(echo = TRUE)
class_diag<-function(probs,truth){
if(is.numeric(truth)==FALSE & is.logical(truth)==FALSE) truth<-as.numeric(truth)-1
tab<-table(factor(probs>.5,levels=c("FALSE","TRUE")),truth)
prediction<-ifelse(probs>.5,1,0)
acc=mean(truth==prediction)
sens=mean(prediction[truth==1]==1)
spec=mean(prediction[truth==0]==0)
ppv=mean(truth[prediction==1]==1)
#CALCULATE EXACT AUC
ord<-order(probs, decreasing=TRUE)
probs <- probs[ord]; truth <- truth[ord]
TPR=cumsum(truth)/max(1,sum(truth))
FPR=cumsum(!truth)/max(1,sum(!truth))
dup<-c(probs[-1]>=probs[-length(probs)], FALSE)
TPR<-c(0,TPR[!dup],1); FPR<-c(0,FPR[!dup],1)
n <- length(TPR)
auc<- sum( ((TPR[-1]+TPR[-n])/2) * (FPR[-1]-FPR[-n]) )
data.frame(acc,sens,spec,ppv,auc)
}
traffic<-read.csv("traffic.csv")
traffic
library(ggplot2)
ggplot(traffic, aes(x = car, y = suv)) +geom_point(alpha = .5) + geom_density_2d(h=2) + coord_fixed() + facet_wrap(~primary.enforcement)
man1<-manova(cbind(car,suv)~primary.enforcement, data=traffic)
summary(man1)
summary.aov(man1)
pairwise.t.test(traffic$car,traffic$primary.enforcement,p.adj="none")
pairwise.t.test(traffic$suv,traffic$primary.enforcement,p.adj="none")
type1<- 1-(.95^5)
boneferroni<- 0.05/5
type1
boneferroni
library(dplyr)
library(vegan)
dists<-traffic%>%select(car, suv)%>%dist()
adonis(dists~speedcamera,data=traffic)
{hist(dists);abline(v=1.6554, col="red")}
library(lmtest)
library(sandwich)
library(ggplot2)
library(dplyr)
traffic$dui_score_c <- traffic$dui_score - mean(traffic$dui_score)
fit<- lm(motorcycle~helmet_law*dui_score_c, traffic)
summary(fit)
ggplot(traffic, aes(dui_score_c,motorcycle)) + geom_smooth(method="lm") + geom_point(aes(color=helmet_law))
resids<-lm(motorcycle~helmet_law*dui_score_c, traffic)$residuals
fitted<-lm(motorcycle~helmet_law*dui_score_c, traffic)$fitted.values
ggplot()+geom_histogram(aes(resids),bins=10)
ggplot()+geom_point(aes(resids,fitted))
resids<-fit$residuals
fitvals<-fit$fitted.values
ggplot()+geom_point(aes(fitvals,resids))+geom_hline(yintercept=0, color='red')
bptest(fit)
coeftest(fit, vcov = vcovHC(fit))[,1:2]
set.seed(348)
samp_distn<-replicate(5000, {
boot_dat <- sample_frac(traffic, replace=T)
fit2 <- lm(motorcycle~helmet_law*dui_score_c, data=boot_dat)
coef(fit2)
})
do.call(rbind,samp_distn) %>% as.data.frame %>% summarize_all(sd, na.rm=T)
library(plotROC)
library(dplyr)
library(lmtest)
traffic2<-traffic%>%mutate(y=ifelse(primary.enforcement=="yes",1,0))
fit3<- glm(y~party+helmet_law, traffic2, family="binomial")
coeftest(fit3)
exp(coef(fit3))
prob<-predict(fit3,type="response")
class_diag(prob,traffic2$y)
pred<-ifelse(prob>.5,1,0)
table(prediction=pred, truth=traffic2$y)%>%addmargins
traffic2$logit<-predict(fit3,type="link")
traffic2%>%ggplot()+geom_density(aes(logit,fill=primary.enforcement), alpha=.4)+
theme(legend.position=c(.85,.85))+geom_vline(xintercept=0)+xlab("predictor (logit)")
ROCplot<-ggplot(traffic2)+geom_roc(aes(d=y,m=prob), n.cuts=0)+
geom_segment(aes(x=0,xend=1,y=0,yend=1),lty=2)
ROCplot
calc_auc(ROCplot)
traffic3<- traffic2[ -c(1, 13) ]
set.seed(1234)
k=10
data<-traffic3[sample(nrow(traffic3)),]
folds<-cut(seq(1:nrow(traffic3)),breaks=k,labels=F)
diags<-NULL
for(i in 1:k){
train<-data[folds!=i,]
test<-data[folds==i,]
truth<-test$y
fit4<-glm(y~(.)^2,data=train,family="binomial")
probs<-predict(fit4,newdata = test,type="response")
diags<-rbind(diags,class_diag(probs,truth))
}
library(plotROC)
library(dplyr)
library(lmtest)
traffic2<-traffic%>%mutate(y=ifelse(primary.enforcement=="yes",1,0))
fit3<- glm(y~party+helmet_law, traffic2, family="binomial")
coeftest(fit3)
exp(coef(fit3))
prob<-predict(fit3,type="response")
class_diag(prob,traffic2$y)
pred<-ifelse(prob>.5,1,0)
table(prediction=pred, truth=traffic2$y)%>%addmargins
traffic2$logit<-predict(fit3,type="link")
traffic2%>%ggplot()+geom_density(aes(logit,fill=primary.enforcement), alpha=.4)+
theme(legend.position=c(.85,.85))+geom_vline(xintercept=0)+xlab("predictor (logit)")
ROCplot<-ggplot(traffic2)+geom_roc(aes(d=y,m=prob), n.cuts=0)+
geom_segment(aes(x=0,xend=1,y=0,yend=1),lty=2)
ROCplot
calc_auc(ROCplot)
traffic3<- traffic2[ -c(1, 13) ]
set.seed(1234)
k=10
data<-traffic3[sample(nrow(traffic3)),]
folds<-cut(seq(1:nrow(traffic3)),breaks=k,labels=F)
diags<-NULL
for(i in 1:k){
train<-data[folds!=i,]
test<-data[folds==i,]
truth<-test$y
fit4<-glm(y~(.)^2,data=train,family="binomial")
probs<-predict(fit4,newdata = test,type="response")
diags<-rbind(diags,class_diag(probs,truth))
}
View(traffic2)
View(traffic3)
library(plotROC)
library(dplyr)
library(lmtest)
traffic2<-traffic%>%mutate(y=ifelse(primary.enforcement=="yes",1,0))
fit3<- glm(y~party+helmet_law, traffic2, family="binomial")
coeftest(fit3)
exp(coef(fit3))
prob<-predict(fit3,type="response")
class_diag(prob,traffic2$y)
pred<-ifelse(prob>.5,1,0)
table(prediction=pred, truth=traffic2$y)%>%addmargins
traffic2$logit<-predict(fit3,type="link")
traffic2%>%ggplot()+geom_density(aes(logit,fill=primary.enforcement), alpha=.4)+
theme(legend.position=c(.85,.85))+geom_vline(xintercept=0)+xlab("predictor (logit)")
ROCplot<-ggplot(traffic2)+geom_roc(aes(d=y,m=prob), n.cuts=0)+
geom_segment(aes(x=0,xend=1,y=0,yend=1),lty=2)
ROCplot
calc_auc(ROCplot)
traffic3<- traffic2[ -c(1, 14) ]
set.seed(1234)
k=10
data<-traffic3[sample(nrow(traffic3)),]
folds<-cut(seq(1:nrow(traffic3)),breaks=k,labels=F)
diags<-NULL
for(i in 1:k){
train<-data[folds!=i,]
test<-data[folds==i,]
truth<-test$y
fit4<-glm(y~(.)^2,data=train,family="binomial")
probs<-predict(fit4,newdata = test,type="response")
diags<-rbind(diags,class_diag(probs,truth))
}
diags%>%summarize_all(mean, na.rm=T)
blogdown::serve_site()
blogdown::serve_site()
blogdown:::new_post_addin()
blogdown:::new_post_addin()
install.packages("reticulate")
y
$ conda activate r-reticulate
yes
yes
yes
library(reticulate)
so<-"stay"
library(reticulate)
so<-"stay healthy"
blogdown:::insert_image_addin()
library(reticulate)
so<-"stay healthy"
traceback()
traceback()
devtools::package_deps("devtools")
install.packages("devtools")
devtools::package_deps("devtools")
blogdown:::new_post_addin()
blogdown:::insert_image_addin()
blogdown:::insert_image_addin()
library(reticulate)
so<-"Stay Healthy"
blogdown::serve_site()
traceback()
traceback()
traceback()
traceback()
library(reticulate)
use_python(usr/bin/python3)
library(reticulate)
use_python(/usr/bin/python3)
library(reticulate)
so<- "Stay Healthy"
traceback()
library(reticulate)
use_python("/usr/bin/python3")
so<- "Stay Healthy"
traceback()
library(reticulate)
use_python("/usr/bin/python3")
so<- "Stay Healthy"
library(reticulate)
use_python("/usr/bin/python3")
so<- "Stay Healthy"
blogdown:::new_post_addin()
library(reticulate)
config_py()
py_config()
blogdown::serve_site()
blogdown::serve_site()
